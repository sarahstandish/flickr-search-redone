(this["webpackJsonpflickr-search-redone"]=this["webpackJsonpflickr-search-redone"]||[]).push([[0],{33:function(e,t,n){},34:function(e,t,n){},60:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),a=n(24),s=n.n(a),o=(n(33),n(34),n(5)),i=n.n(o),l=n(6),h=n(9),u=n(2),j=n(25),b=n(7),p=n(0);var m=function(e){var t=e.callsThisHour>3600?"dpiSearchInvisible":"dpiSearchVisible";return Object(p.jsxs)("form",{children:[Object(p.jsx)("h2",{children:"Flickr Search"}),Object(p.jsx)("label",{children:"Search term"}),Object(p.jsx)("input",{type:"text",name:"search_term",placeholder:"Looking for photos of...",value:e.search_term,onChange:e.handleChange,required:!0}),Object(p.jsx)("label",{children:"City"}),Object(p.jsx)("input",{type:"text",name:"location",placeholder:"Photos taken in or around...",value:e.location,onChange:e.handleChange}),Object(p.jsx)("label",{children:"Licenses"}),Object(p.jsx)("p",{className:"explanation",children:"Default selection: images licensed for commercial use and modifications"}),Object(p.jsxs)("div",{className:"licenses",children:[Object(p.jsxs)("label",{className:"container",children:["All Rights Reserved",Object(p.jsx)("input",{type:"checkbox",name:"0",value:"0",checked:e.props.licenses[0],onChange:e.handleChange}),Object(p.jsx)("span",{className:"checkmark"})]}),Object(p.jsxs)("label",{className:"container",children:["Attribution-NonCommercial-ShareAlike License",Object(p.jsx)("a",{href:"https://creativecommons.org/licenses/by-nc-sa/2.0/",target:"_blank",rel:"noreferrer",children:"     Learn more"}),Object(p.jsx)("input",{type:"checkbox",name:"1",value:"1",checked:e.props.licenses[1],onChange:e.handleChange}),Object(p.jsx)("span",{className:"checkmark"})]}),Object(p.jsxs)("label",{className:"container",children:["Attribution-NonCommercial License",Object(p.jsx)("a",{href:"https://creativecommons.org/licenses/by-nc/2.0/",target:"_blank",rel:"noreferrer",children:"     Learn more"}),Object(p.jsx)("input",{type:"checkbox",name:"2",value:"2",checked:e.props.licenses[2],onChange:e.handleChange}),Object(p.jsx)("span",{className:"checkmark"})]}),Object(p.jsxs)("label",{className:"container",children:["Attribution-NonCommercial-NoDerivs License",Object(p.jsx)("a",{href:"https://creativecommons.org/licenses/by-nc-nd/2.0/",target:"_blank",rel:"noreferrer",children:"     Learn more"}),Object(p.jsx)("input",{type:"checkbox",name:"3",value:"3",checked:e.props.licenses[3],onChange:e.handleChange}),Object(p.jsx)("span",{className:"checkmark"})]}),Object(p.jsxs)("label",{className:"container",children:["Attribution License",Object(p.jsx)("a",{href:"https://creativecommons.org/licenses/by/2.0/",target:"_blank",rel:"noreferrer",children:"     Learn more"}),Object(p.jsx)("input",{type:"checkbox",name:"4",value:"4",checked:e.props.licenses[4],onChange:e.handleChange}),Object(p.jsx)("span",{className:"checkmark"})]}),Object(p.jsxs)("label",{className:"container",children:["Attribution-ShareAlike License",Object(p.jsx)("a",{href:"https://creativecommons.org/licenses/by-sa/2.0/",target:"_blank",rel:"noreferrer",children:"     Learn more"}),Object(p.jsx)("input",{type:"checkbox",name:"5",value:"5",checked:e.props.licenses[5],onChange:e.handleChange}),Object(p.jsx)("span",{className:"checkmark"})]}),Object(p.jsxs)("label",{className:"container",children:["Attribution-NoDerivs License  ",Object(p.jsx)("a",{href:"https://creativecommons.org/licenses/by-nd/2.0/",target:"_blank",rel:"noreferrer",children:"     Learn more"}),Object(p.jsx)("input",{type:"checkbox",name:"6",value:"6",checked:e.props.licenses[6],onChange:e.handleChange}),Object(p.jsx)("span",{className:"checkmark"})]}),Object(p.jsxs)("label",{className:"container",children:["No known copyright restrictions  ",Object(p.jsx)("a",{href:"https://www.flickr.com/commons/usage/",target:"_blank",rel:"noreferrer",children:"     Learn more"}),Object(p.jsx)("input",{type:"checkbox",name:"7",value:"7",checked:e.props.licenses[7],onChange:e.handleChange}),Object(p.jsx)("span",{className:"checkmark"})]}),Object(p.jsxs)("label",{className:"container",children:["United States Government Work",Object(p.jsx)("a",{href:"http://www.usa.gov/copyright.shtml",target:"_blank",rel:"noreferrer",children:"     Learn more"}),Object(p.jsx)("input",{type:"checkbox",name:"8",value:"8",checked:e.props.licenses[8],onChange:e.handleChange}),Object(p.jsx)("span",{className:"checkmark"})]}),Object(p.jsxs)("label",{className:"container",children:["Public Domain Dedication (CC0)",Object(p.jsx)("a",{href:"https://creativecommons.org/publicdomain/zero/1.0/",target:"_blank",rel:"noreferrer",children:"     Learn more"}),Object(p.jsx)("input",{type:"checkbox",name:"9",value:"9",checked:e.props.licenses[9],onChange:e.handleChange}),Object(p.jsx)("span",{className:"checkmark"})]}),Object(p.jsxs)("label",{className:"container",children:["Public Domain Mark",Object(p.jsx)("a",{href:"https://creativecommons.org/publicdomain/mark/1.0/",target:"_blank",rel:"noreferrer",children:"     Learn more"}),Object(p.jsx)("input",{type:"checkbox",name:"10",value:"10",checked:e.props.licenses[10],onChange:e.handleChange}),Object(p.jsx)("span",{className:"checkmark"})]})]}),Object(p.jsxs)("div",{className:t,children:[Object(p.jsx)("label",{children:"Minimum DPI"}),Object(p.jsx)("input",{type:"number",name:"dpi",value:e.dpi,onChange:e.handleChange})]}),Object(p.jsx)("button",{children:"Submit"})]})},d="7441a4ff83fda0c1e35cbd7c4016210f",f="AIzaSyBAFrEcXX5Gv_IRzXexjpfJ-S5Usii85D8";function O(e,t,n){return x.apply(this,arguments)}function x(){return(x=Object(l.a)(i.a.mark((function e(t,n,c){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=k(t.licenses),e.abrupt("return","https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=".concat(d,"&text=").concat(t.search_term,"&content_type=1&per_page=250&format=json&nojsoncallback=1&sort=relevance&radius=32&lat=").concat(n,"&lon=").concat(c,"&license=").concat(r));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return Object.keys(e).filter((function(t){return e[t]})).join(",")}function g(e){return v.apply(this,arguments)}function v(){return(v=Object(l.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.abrupt("return",["%00","%00"]);case 4:return n="https://maps.googleapis.com/maps/api/geocode/json?address=".concat(t,"&key=").concat(f),e.abrupt("return",fetch(n).then((function(e){return e.json()})).then((function(e){return[e.results[0].geometry.bounds.northeast.lat,e.results[0].geometry.bounds.northeast.lng]})).catch((function(){return["%00","%00"]})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t){return C.apply(this,arguments)}function C(){return(C=Object(l.a)(i.a.mark((function e(t,n){var c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c="https://www.flickr.com/services/rest/?method=flickr.photos.getExif&api_key=".concat(d,"&photo_id=").concat(t.id,"&secret=").concat(t.secret,"&format=json&nojsoncallback=1"),e.abrupt("return",fetch(c).then((function(e){return e.json()})).then((function(e){if(Object.keys(e.photo).includes("exif")&&e.photo.exif.some((function(e){return Object.values(e).includes("X-Resolution")&&parseInt(e.raw._content)>=n})))return t})).catch((function(){return null})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=function(e){var t=e.props,n="https://www.flickr.com/photos/".concat(t.owner,"/").concat(t.id),c="https://live.staticflickr.com/".concat(t.server,"/").concat(t.id,"_").concat(t.secret,"_n.jpg");return Object(p.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:Object(p.jsx)("img",{src:c,alt:t.title})})};var w,S=function(e){var t,n=(e.props.thisHour/3600*100).toFixed(0);return t=n<50?"API calls this hour are at ".concat(n,"% of the hourly limit."):n<80?"API calls this hour are at ".concat(n,"% of the hourly limit.\nTip: searching with DPI performs many more API calls, so search without it unless needed."):n<100?"API calls this hour are at ".concat(n,"% of the hourly limit.\nAfter the limit is exceeded, DPI search will be temporarily disabled."):"API calls this hour are over the hourly limit and DPI search has been disabled.\nCheck back later to search with DPI again.",Object(p.jsx)("div",{className:"error",children:Object(p.jsx)("p",{children:t})})},_=n(26);w="index.html";var L=n.n(_).a.create({baseURL:w}),E={newCall:function(e){return L.post("/searchCalls",e)},getCalls:function(){return L.get("/searchCalls")}};var A=function(){var e=Object(c.useState)({search_term:"",licenses:{0:!1,1:!1,2:!1,3:!1,4:!0,5:!0,6:!1,7:!0,8:!0,9:!0,10:!0},dpi:"",location:""}),t=Object(b.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)([]),s=Object(b.a)(a,2),o=s[0],d=s[1],f=Object(c.useState)({searchError:"",locationError:""}),x=Object(b.a)(f,2),k=x[0],v=x[1],C=Object(c.useState)({thisSession:0,thisHour:0}),w=Object(b.a)(C,2),_=w[0],L=w[1];Object(c.useEffect)((function(){var e=0,t=Date.now()-36e5;E.getCalls().then((function(n){var c,r=n.data.data.slice(-100).reverse(),a=Object(j.a)(r);try{for(a.s();!(c=a.n()).done;){var s=c.value;if(!(s.dateTime>=t))break;e+=s.calls}}catch(o){a.e(o)}finally{a.f()}L((function(t){return Object(u.a)(Object(u.a)({},t),{},{thisHour:e})}))})).catch((function(e){return console.log("Error: ",e)}))}),[]),Object(c.useEffect)((function(){_.thisSession>36&&E.newCall({calls:_.thisSession}).then(L((function(e){return Object(u.a)(Object(u.a)({},e),{},{thisSession:0})}))).catch((function(e){console.log(e)}))}),[_.thisSession]);var A=function(){var e=Object(l.a)(i.a.mark((function e(){var t,c,r,a,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(n.location);case 2:return t=e.sent,c=Object(b.a)(t,2),r=c[0],a=c[1],n.location&&"%00"===r?v((function(e){return Object(u.a)(Object(u.a)({},e),{},{locationError:"Your location could not be found; search completed for all locations."})})):v((function(e){return Object(u.a)(Object(u.a)({},e),{},{locationError:""})})),e.next=9,O(n,r,a);case 9:return s=e.sent,e.next=12,fetch(s).then((function(e){if(e.ok)return L((function(e){return{thisHour:e.thisHour+1,thisSession:e.thisSession+1}})),e.json()})).then((function(e){return n.dpi?(L((function(t){return{thisHour:t.thisHour+e.photos.photo.length,thisSession:t.thisSession+e.photos.photo.length}})),Promise.all(e.photos.photo.map((function(e){return y(e,n.dpi)}))).then((function(e){return e.filter((function(e){return e}))})).catch((function(e){return console.log(e)}))):e.photos.photo}));case 12:0===(o=e.sent).length?v((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchError:"No results matched your search."})})):v((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchError:""})})),d(o.map((function(e){return Object(p.jsx)(N,{props:e},e.id)})));case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:"form",onSubmit:function(e){e.preventDefault(),A()},children:[Object(p.jsx)(m,{handleChange:function(e){var t=e.target,c=t.name,a=t.value,s=t.type,o=t.checked;r("checkbox"===s?Object(u.a)(Object(u.a)({},n),{},{licenses:Object(u.a)(Object(u.a)({},n.licenses),{},Object(h.a)({},c,o))}):Object(u.a)(Object(u.a)({},n),{},Object(h.a)({},c,a)))},props:n,callsThisHour:_.thisHour}),_.thisHour>0?Object(p.jsx)(S,{props:_}):null,Object(p.jsx)("p",{className:"error",children:k.locationError}),Object(p.jsx)("p",{className:"error",children:k.searchError}),Object(p.jsx)("div",{className:"photos",children:o})]})},P=n(28);var D=function(){return console.log("production"),console.log(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).PORT),Object(p.jsx)(P.a,{children:Object(p.jsx)("div",{className:"App",children:Object(p.jsx)(A,{})})})},I=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,61)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),c(e),r(e),a(e),s(e)}))};s.a.render(Object(p.jsx)(r.a.StrictMode,{children:Object(p.jsx)(D,{})}),document.getElementById("root")),I()}},[[60,1,2]]]);
//# sourceMappingURL=main.ac0d56d0.chunk.js.map